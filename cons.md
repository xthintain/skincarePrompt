# 化妆品分析和推荐系统 - 项目架构

## 系统架构总览

本系统采用分层架构设计,包含数据层、业务逻辑层、应用层和展示层,确保系统的可扩展性、可维护性和高性能。

```
┌─────────────────────────────────────────────────────────────┐
│                      展示层 (Presentation Layer)              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │         React Dashboard (可视化交互大屏)              │   │
│  │  - 数据可视化组件 - 推荐结果展示 - 交互式图表        │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            ↕ RESTful API
┌─────────────────────────────────────────────────────────────┐
│                    应用层 (Application Layer)                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │  Web API Server │  │   BI Analytics   │  │ Scheduler   │ │
│  │  (Flask/FastAPI)│  │   (交互式BI)     │  │ (定时任务)  │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────┘
                            ↕
┌─────────────────────────────────────────────────────────────┐
│                  业务逻辑层 (Business Logic Layer)            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │推荐引擎模块  │  │数据分析模块  │  │特征工程模块  │     │
│  │- 协同过滤    │  │- 聚类分析    │  │- 特征提取    │     │
│  │- 内容推荐    │  │- 分类预测    │  │- 特征选择    │     │
│  │- 混合推荐    │  │- 关联分析    │  │- 特征转换    │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │模型训练模块  │  │评估模块      │  │可视化模块    │     │
│  │- scikit-learn│  │- 交叉验证    │  │- matplotlib  │     │
│  │- 模型持久化  │  │- 性能指标    │  │- seaborn     │     │
│  │- 超参数调优  │  │- A/B测试     │  │- plotly      │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
└─────────────────────────────────────────────────────────────┘
                            ↕
┌─────────────────────────────────────────────────────────────┐
│                      数据层 (Data Layer)                      │
│  ┌────────────────────────────────────────────────────────┐ │
│  │              数据仓库 (Data Warehouse)                  │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │ │
│  │  │  事实表     │  │  维度表     │  │  汇总表     │   │ │
│  │  │- 用户行为   │  │- 产品维度   │  │- 统计指标   │   │ │
│  │  │- 产品销售   │  │- 用户维度   │  │- 分析结果   │   │ │
│  │  │- 评价记录   │  │- 时间维度   │  │- 模型输出   │   │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘   │ │
│  └────────────────────────────────────────────────────────┘ │
│  ┌────────────────────────────────────────────────────────┐ │
│  │              ETL处理层 (Python Scripts)                 │ │
│  │  - 数据抽取 (Extract) - 数据转换 (Transform)           │ │
│  │  - 数据加载 (Load) - 数据质量检查                      │ │
│  └────────────────────────────────────────────────────────┘ │
│  ┌────────────────────────────────────────────────────────┐ │
│  │              数据源 (Data Sources)                      │ │
│  │  - CSV/JSON文件 - 爬虫数据 - 用户行为日志             │ │
│  └────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 核心模块架构

### 1. 数据处理架构

```
数据源 → 数据采集 → 数据清洗 → 数据转换 → 数据仓库 → 数据应用
  ↓         ↓          ↓          ↓          ↓          ↓
原始数据   pandas    pandas     pandas   PostgreSQL   模型/BI
         (读取)    (清洗)     (转换)    (存储)      (应用)
```

**组件说明**:
- **数据采集器**: 从多种数据源获取原始数据
- **数据清洗器**: 使用pandas处理缺失值、异常值、重复值
- **数据转换器**: 特征编码、标准化、衍生变量生成
- **数据加载器**: 将处理后数据加载到数据仓库

### 2. 数据仓库架构

#### 2.1 星型模型设计

```
                    ┌──────────────┐
                    │  产品维度表  │
                    │  dim_product │
                    └──────┬───────┘
                           │
        ┌──────────────┐   │   ┌──────────────┐
        │  用户维度表  │───┼───│  时间维度表  │
        │  dim_user    │   │   │  dim_date    │
        └──────┬───────┘   │   └──────┬───────┘
               │           │          │
               │     ┌─────┴─────┐    │
               └─────│  事实表   │────┘
                     │ fact_user │
                     │ _behavior │
                     └───────────┘
                           │
                    ┌──────┴───────┐
                    │  成分维度表  │
                    │dim_ingredient│
                    └──────────────┘
```

#### 2.2 数据表设计

**事实表**:
- `fact_user_behavior`: 用户行为事实表
  - user_id, product_id, date_id, behavior_type, rating, etc.
- `fact_sales`: 销售事实表
  - product_id, date_id, sales_amount, quantity, etc.

**维度表**:
- `dim_product`: 产品维度
  - product_id, brand, category, price, ingredients, etc.
- `dim_user`: 用户维度
  - user_id, age, gender, skin_type, preferences, etc.
- `dim_date`: 时间维度
  - date_id, year, month, day, quarter, etc.
- `dim_ingredient`: 成分维度
  - ingredient_id, name, function, safety_level, etc.

### 3. 推荐系统架构

```
┌─────────────────────────────────────────────────────────┐
│                    推荐系统核心引擎                      │
│                                                          │
│  ┌────────────────┐  ┌────────────────┐  ┌───────────┐ │
│  │ 协同过滤模块   │  │ 内容推荐模块   │  │ 混合模块  │ │
│  │                │  │                │  │           │ │
│  │ - 用户协同     │  │ - 成分相似度   │  │ - 加权融合│ │
│  │ - 物品协同     │  │ - 属性匹配     │  │ - 投票机制│ │
│  │ - 矩阵分解     │  │ - TF-IDF       │  │ - Stacking│ │
│  └────────────────┘  └────────────────┘  └───────────┘ │
│                                                          │
│  ┌─────────────────────────────────────────────────┐   │
│  │           推荐结果后处理                         │   │
│  │  - 多样性控制  - 新颖性过滤  - 业务规则         │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────┐
│              推荐结果排序与展示                          │
└─────────────────────────────────────────────────────────┘
```

**算法实现** (基于scikit-learn):
- K近邻(KNN): 用户/物品相似度计算
- 余弦相似度: 特征向量相似度
- 矩阵分解(SVD): 潜在因子提取
- TF-IDF: 文本特征提取(成分、描述)

### 4. 数据挖掘架构

```
┌─────────────────────────────────────────────────────────┐
│                  数据挖掘工作流                          │
│                                                          │
│  数据准备 → 特征工程 → 模型训练 → 模型评估 → 模型部署  │
│     ↓          ↓          ↓          ↓          ↓       │
│  pandas    sklearn    sklearn    sklearn    pickle      │
│  numpy     (特征)    (模型)      (评估)     (持久化)     │
└─────────────────────────────────────────────────────────┘
```

**核心算法库** (scikit-learn):

1. **聚类算法**:
   - K-means: 用户分群、产品聚类
   - DBSCAN: 密度聚类(异常检测)
   - 层次聚类: 成分关系分析

2. **分类算法**:
   - 随机森林: 用户偏好预测
   - SVM: 皮肤类型分类
   - 逻辑回归: 购买意愿预测

3. **降维算法**:
   - PCA: 特征降维
   - t-SNE: 可视化降维

4. **关联规则**:
   - Apriori: 产品关联分析(需外部库)

### 5. 可视化架构

#### 5.1 数据可视化层次

```
┌─────────────────────────────────────────────────────────┐
│                   React Dashboard                        │
│  ┌───────────────────────────────────────────────────┐  │
│  │  可视化组件库 (ECharts/Recharts/D3.js)           │  │
│  │  - 折线图  - 柱状图  - 饼图  - 雷达图  - 热力图 │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                         ↕ API
┌─────────────────────────────────────────────────────────┐
│                   交互式BI系统                           │
│  - 多维分析  - 钻取功能  - 实时刷新  - 报表导出        │
└─────────────────────────────────────────────────────────┘
                         ↕
┌─────────────────────────────────────────────────────────┐
│              Python可视化后端                            │
│  matplotlib + seaborn + plotly                          │
│  - 静态图表生成  - 数据预处理  - 图表配置              │
└─────────────────────────────────────────────────────────┘
```

#### 5.2 React Dashboard组件架构

```
App (Root)
│
├── Layout
│   ├── Header (导航栏)
│   ├── Sidebar (侧边栏菜单)
│   └── MainContent
│
├── Dashboard (主面板)
│   ├── OverviewPanel (概览面板)
│   │   ├── KPICard (关键指标卡片)
│   │   ├── TrendChart (趋势图)
│   │   └── DistributionChart (分布图)
│   │
│   ├── RecommendationPanel (推荐面板)
│   │   ├── ProductList (推荐产品列表)
│   │   ├── SimilarityMatrix (相似度矩阵热力图)
│   │   └── UserProfile (用户画像雷达图)
│   │
│   ├── AnalyticsPanel (分析面板)
│   │   ├── ClusterVisualization (聚类可视化)
│   │   ├── FeatureImportance (特征重要性图)
│   │   └── CorrelationHeatmap (相关性热力图)
│   │
│   └── IngredientPanel (成分分析面板)
│       ├── IngredientNetwork (成分网络图)
│       ├── SafetyAnalysis (安全性分析)
│       └── EffectivenessChart (功效分析)
│
└── Shared Components
    ├── FilterBar (筛选器)
    ├── DateRangePicker (日期选择)
    ├── ExportButton (导出功能)
    └── LoadingSpinner (加载动画)
```

### 6. API服务架构

```
┌─────────────────────────────────────────────────────────┐
│                   API Gateway                            │
│              (Flask/FastAPI Server)                      │
│  ┌───────────────────────────────────────────────────┐  │
│  │  认证中间件  │  限流中间件  │  日志中间件        │  │
│  └───────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────┐  │
│  │              RESTful API Endpoints                 │  │
│  │                                                     │  │
│  │  /api/recommendations  - 获取推荐结果             │  │
│  │  /api/products         - 产品查询                 │  │
│  │  /api/users            - 用户信息                 │  │
│  │  /api/analytics        - 分析数据                 │  │
│  │  /api/visualizations   - 可视化数据               │  │
│  │  /api/models           - 模型管理                 │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**API设计规范**:
- RESTful风格
- JSON数据格式
- JWT认证机制
- 统一错误处理
- 版本控制 (/api/v1/...)

### 7. 部署架构

```
┌─────────────────────────────────────────────────────────┐
│                WSL Ubuntu 20.04 环境                     │
│                                                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Docker    │  │   Docker    │  │   Docker    │    │
│  │ Container   │  │ Container   │  │ Container   │    │
│  │             │  │             │  │             │    │
│  │   React     │  │   Flask/    │  │ PostgreSQL  │    │
│  │   Frontend  │  │  FastAPI    │  │  Database   │    │
│  │   (Nginx)   │  │   Backend   │  │             │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
│         ↑                 ↑                 ↑           │
│         └─────────────────┴─────────────────┘           │
│                   Docker Compose                        │
└─────────────────────────────────────────────────────────┘
```

## 数据流架构

```
用户输入 → React Frontend → API Gateway → 业务逻辑层
                                              ↓
                                         推荐引擎
                                              ↓
                                         数据仓库
                                              ↓
API Gateway ← 推荐结果 ← 后处理 ← 模型预测结果
    ↓
React Frontend → 用户界面展示
```

## 安全架构

```
┌─────────────────────────────────────────────────────────┐
│                      安全层                              │
│  ┌───────────────────────────────────────────────────┐  │
│  │  身份认证  │  权限控制  │  数据加密  │  审计日志  │  │
│  └───────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────┐  │
│  │  SQL注入防护  │  XSS防护  │  CSRF防护            │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

## 性能优化架构

```
┌─────────────────────────────────────────────────────────┐
│                    缓存层                                │
│  ┌───────────────────────────────────────────────────┐  │
│  │  Redis缓存 (可选)                                 │  │
│  │  - 推荐结果缓存  - 频繁查询缓存  - Session缓存   │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────┐
│                  异步处理                                │
│  - 后台模型训练  - 批量数据处理  - 定时任务调度        │
└─────────────────────────────────────────────────────────┘
```

## 可扩展性设计

### 水平扩展
- 应用服务器: 多实例部署,负载均衡
- 数据库: 读写分离,主从复制
- 缓存: 分布式缓存集群

### 垂直扩展
- 模型优化: 算法优化,特征降维
- 数据库优化: 索引优化,查询优化
- 代码优化: 性能分析,瓶颈消除

## 监控与日志架构

```
┌─────────────────────────────────────────────────────────┐
│                  监控系统                                │
│  - 系统性能监控  - API响应时间  - 错误率统计           │
│  - 模型性能监控  - 数据质量监控                        │
└─────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────┐
│                  日志系统                                │
│  - 应用日志  - 访问日志  - 错误日志  - 审计日志       │
└─────────────────────────────────────────────────────────┘
```

## 技术选型总结

| 层次 | 技术选型 | 说明 |
|------|---------|------|
| 数据处理 | pandas, numpy | 数据清洗、转换、分析 |
| 数据存储 | PostgreSQL/MySQL | 关系型数据仓库 |
| 数据挖掘 | scikit-learn | 机器学习算法库 |
| 后端框架 | Flask/FastAPI | API服务 |
| 前端框架 | React 18+ | 交互式UI |
| 可视化 | ECharts/Recharts, matplotlib, seaborn | 图表展示 |
| 部署环境 | Docker, WSL Ubuntu 20.04 | 容器化部署 |
| BI工具 | Tableau/Superset(待定) | 交互式分析 |

## 架构优势

1. **模块化设计**: 各层职责清晰,易于维护和扩展
2. **技术成熟**: 采用业界主流技术栈,稳定可靠
3. **高性能**: 缓存机制、异步处理保证系统响应速度
4. **可扩展**: 支持水平和垂直扩展
5. **安全性**: 多层安全防护机制
6. **学术性**: 算法实现基于学术论文验证

## 后续优化方向

1. 引入深度学习模型(TensorFlow/PyTorch)增强推荐效果
2. 实现实时推荐系统(流式计算)
3. 增加A/B测试平台
4. 引入知识图谱增强成分分析
5. 移动端适配
